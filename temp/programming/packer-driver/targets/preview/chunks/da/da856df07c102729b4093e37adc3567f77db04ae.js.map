{"version":3,"sources":["file:///Users/super_javan/cocoscreator/CrampedRoomOfDeathDungeon/assets/Scripts/TileMap/TileMapManager.ts"],"names":["Component","_decorator","SpriteAtlas","ResourceLoadMgr","DataManager","createNewNode","randomTileByrange","TileManager","ccclass","property","TileMapManager","start","init","spriteAtlas","Instance","loadRes","mapInfo","tileMgrInfo","i","length","colnum","j","item","src","type","num","node","imgSrc","sp","spriteFrames","tileManager","addComponent","setParent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,S,OAAAA,S;AAAWC,MAAAA,U,OAAAA,U;AAAuEC,MAAAA,W,OAAAA,W;;AAEpFC,MAAAA,e;;AACAC,MAAAA,W;;AAEEC,MAAAA,a,iBAAAA,a;AAAeC,MAAAA,iB,iBAAAA,iB;;AACfC,MAAAA,W,iBAAAA,W;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;gCAEjBS,c,WADZF,OAAO,CAAC,gBAAD,C,gBAAR,MACaE,cADb,SACoCV,SADpC,CAC8C;AAC1CW,QAAAA,KAAK,GAAG,CAEP;;AAEKC,QAAAA,IAAI,GAAG;AAAA;;AAAA;AACT,gBAAMC,WAAW,SAAS;AAAA;AAAA,oDAAgBC,QAAhB,CAAyBC,OAAzB,CAAiC,mBAAjC,EAAsDb,WAAtD,CAA1B;AACA,gBAAI;AAAEc,cAAAA,OAAF;AAAWC,cAAAA;AAAX,gBAA2B;AAAA;AAAA,4CAAYH,QAA3C;AACAG,YAAAA,WAAW,GAAG,EAAd;;AAEA,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,OAAO,CAACG,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,kBAAME,MAAM,GAAGJ,OAAO,CAACE,CAAD,CAAtB;AACAD,cAAAA,WAAW,CAACC,CAAD,CAAX,GAAiB,EAAjB;;AACA,mBAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAAM,CAACD,MAA3B,EAAmCE,CAAC,EAApC,EAAwC;AACpC,oBAAMC,IAAI,GAAGF,MAAM,CAACC,CAAD,CAAnB;;AACA,oBAAIC,IAAI,CAACC,GAAL,KAAa,IAAb,IAAqBD,IAAI,CAACE,IAAL,KAAc,IAAvC,EAA6C;AACzC;AACH;;AAED,oBAAIC,GAAG,GAAGH,IAAI,CAACC,GAAf;AACA,oBAAIC,IAAI,GAAGF,IAAI,CAACE,IAAhB;;AACA,oBAAI,CAACC,GAAG,KAAK,CAAR,IAAaA,GAAG,KAAK,CAArB,IAA0BA,GAAG,KAAK,CAAnC,KAA0CP,CAAC,GAAG,CAAJ,KAAU,CAAV,IAAeG,CAAC,GAAG,CAAJ,KAAU,CAAvE,EAA2E;AACvEI,kBAAAA,GAAG,IAAI;AAAA;AAAA,8DAAkB,CAAlB,EAAqB,CAArB,CAAP;AACH,iBAVmC,CAWpC;;;AACA,oBAAMC,IAAI,GAAG;AAAA;AAAA,qDAAb;AACA,oBAAMC,MAAM,cAAYF,GAAZ,MAAZ;AACA,oBAAMG,EAAE,GAAGf,WAAW,CAACgB,YAAZ,CAAyBF,MAAzB,CAAX,CAdoC,CAepC;;AAEA,oBAAMG,WAAW,GAAGJ,IAAI,CAACK,YAAL;AAAA;AAAA,+CAApB;AACAd,gBAAAA,WAAW,CAACC,CAAD,CAAX,CAAeG,CAAf,IAAoBS,WAApB;AACAA,gBAAAA,WAAW,CAAClB,IAAZ,CAAiBY,IAAjB,EAAuBI,EAAvB,EAA2B;AAAEV,kBAAAA,CAAF;AAAKG,kBAAAA;AAAL,iBAA3B;AACAK,gBAAAA,IAAI,CAACM,SAAL,CAAe,KAAI,CAACN,IAApB;AACH;AACJ;AA9BQ;AA+BZ;;AApCyC,O","sourcesContent":["import { Component, _decorator, Node, resources, SpriteFrame, Sprite, UITransform, Layers, SpriteAtlas, Texture2D } from \"cc\";\nimport levels from \"../../Levels\";\nimport ResourceLoadMgr from \"../Base/ResourceLoadMgr\";\nimport DataManager from \"../Runtime/DataManager\";\n// import { DataManagerInstance } from \"../Runtime/DataManager\";\nimport { createNewNode, randomTileByrange } from \"../Utils\";\nimport { TileManager } from \"./TileManager\";\n\nconst { ccclass, property } = _decorator;\n@ccclass('TileMapManager')\nexport class TileMapManager extends Component {\n    start() {\n\n    }\n\n    async init() {\n        const spriteAtlas = await ResourceLoadMgr.Instance.loadRes('texture/tile/tile', SpriteAtlas)\n        let { mapInfo, tileMgrInfo } = DataManager.Instance\n        tileMgrInfo = []\n\n        for (let i = 0; i < mapInfo.length; i++) {\n            const colnum = mapInfo[i];\n            tileMgrInfo[i] = []\n            for (let j = 0; j < colnum.length; j++) {\n                const item = colnum[j];\n                if (item.src === null || item.type === null) {\n                    continue\n                }\n\n                let num = item.src\n                let type = item.type\n                if ((num === 1 || num === 5 || num === 9) && (i % 2 === 0 && j % 2 === 0)) {\n                    num += randomTileByrange(0, 4)\n                }\n                // console.log('num', num)\n                const node = createNewNode()\n                const imgSrc = `tile (${num})`\n                const sp = spriteAtlas.spriteFrames[imgSrc]\n                // sprite.spriteFrame = spriteFrames.find(v => v.name === imgSrc) || spriteFrames[0]    \n\n                const tileManager = node.addComponent(TileManager)\n                tileMgrInfo[i][j] = tileManager\n                tileManager.init(type, sp, { i, j })\n                node.setParent(this.node)\n            }\n        }\n    }\n}"]}