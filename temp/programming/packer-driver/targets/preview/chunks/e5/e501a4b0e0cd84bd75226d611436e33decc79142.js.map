{"version":3,"sources":["file:///Users/super_javan/cocoscreator/CrampedRoomOfDeathDungeon/assets/Scripts/Spikes/SpikeStateMachine.ts"],"names":["_decorator","Animation","ENITIY_TYPE_SPIKES_ENUM","PARAMS_NAME_TYPE","SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM","getParamsInitNumber","StateMachine","SpikesFourSubStateMachine","SpikesMgr","SpikesOneSubStateMachine","SpikesThreeSubStateMachine","SpikesTwoSubStateMachine","ccclass","property","SpikeStateMachine","init","animationCom","addComponent","initParams","initSateMachine","addAnimationEvent","Promise","all","waitList","params","set","SPIKES_CUR_COUNT","SPIKES_TOTAL_COUNT","stateMachine","SPIKES_ONE","SPIKES_TWO","SPIKES_THREE","SPIKES_FOUR","on","EventType","FINISHED","animationName","defaultClip","name","value","getParams","includes","node","getComponent","countToZero","run","currentSate","get"],"mappings":"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","sourcesContent":["import { Component, _decorator, Node, AnimationClip, Animation, SpriteFrame, SpriteAtlas } from \"cc\";\nimport { ENITIY_TYPE_ENUM, ENITIY_TYPE_SPIKES_ENUM, PARAMS_NAME_TYPE, SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM } from \"../../Enum\";\nimport { EnitiyMgr } from \"../Base/EnitiyMgr\";\nimport { getParamsInitNumber, StateMachine } from \"../Base/SateMachine\";\nimport SpikesFourSubStateMachine from \"./SpikesFourStateMahine\";\nimport { SpikesMgr } from \"./SpikesMgr\";\nimport SpikesOneSubStateMachine from \"./SpikesOneSubStateMachine\";\nimport SpikesThreeSubStateMachine from \"./SpikesThreeStateMachine\";\nimport SpikesTwoSubStateMachine from \"./SpikesTwoSubStateMachine\";\n// import { DataManager.Instance } from \"../Runtime/DataManager\";\n\n\nconst { ccclass, property } = _decorator;\n@ccclass('SpikeStateMachine')\nexport class SpikeStateMachine extends StateMachine {\n    async init() {\n        this.animationCom = this.addComponent(Animation)\n\n        this.initParams()\n        this.initSateMachine()\n        this.addAnimationEvent()\n\n        await Promise.all(this.waitList)\n    }\n\n    initParams() {\n        this.params.set(PARAMS_NAME_TYPE.SPIKES_CUR_COUNT, getParamsInitNumber())\n        this.params.set(PARAMS_NAME_TYPE.SPIKES_TOTAL_COUNT, getParamsInitNumber())\n    }\n\n    initSateMachine() {\n        this.stateMachine.set(ENITIY_TYPE_SPIKES_ENUM.SPIKES_ONE, new SpikesOneSubStateMachine(this))\n        this.stateMachine.set(ENITIY_TYPE_SPIKES_ENUM.SPIKES_TWO, new SpikesTwoSubStateMachine(this))\n        this.stateMachine.set(ENITIY_TYPE_SPIKES_ENUM.SPIKES_THREE, new SpikesThreeSubStateMachine(this))\n        this.stateMachine.set(ENITIY_TYPE_SPIKES_ENUM.SPIKES_FOUR, new SpikesFourSubStateMachine(this))\n    }\n\n    addAnimationEvent() {\n        this.animationCom.on(Animation.EventType.FINISHED, () => {\n            const animationName = this.animationCom.defaultClip.name\n            const value = this.getParams(PARAMS_NAME_TYPE.SPIKES_TOTAL_COUNT).value\n            if (value === SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM.SPIKES_ONE && animationName.includes('spikestwo') ||\n                value === SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM.SPIKES_TWO && animationName.includes('spikesthree') ||\n                value === SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM.SPIKES_THREE && animationName.includes('spikesfour') ||\n                value === SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM.SPIKES_FOUR && animationName.includes('five/five')\n            ) {\n                this.node.getComponent(SpikesMgr).countToZero()\n            }\n        })\n    }\n\n    run() {\n        const value = this.getParams(PARAMS_NAME_TYPE.SPIKES_TOTAL_COUNT).value\n        switch (this.currentSate) {\n            case this.stateMachine.get(ENITIY_TYPE_SPIKES_ENUM.SPIKES_ONE):\n            case this.stateMachine.get(ENITIY_TYPE_SPIKES_ENUM.SPIKES_TWO):\n            case this.stateMachine.get(ENITIY_TYPE_SPIKES_ENUM.SPIKES_THREE):\n            case this.stateMachine.get(ENITIY_TYPE_SPIKES_ENUM.SPIKES_FOUR):\n\n                if (value === SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM.SPIKES_ONE) {\n                    this.currentSate = this.stateMachine.get(ENITIY_TYPE_SPIKES_ENUM.SPIKES_ONE)\n                } else if (value === SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM.SPIKES_TWO) {\n                    this.currentSate = this.stateMachine.get(ENITIY_TYPE_SPIKES_ENUM.SPIKES_TWO)\n                } else if (value === SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM.SPIKES_THREE) {\n                    this.currentSate = this.stateMachine.get(ENITIY_TYPE_SPIKES_ENUM.SPIKES_THREE)\n                } else if (value === SPIKES_TYPE_MAP_TOTAL_COUNT_ENUM.SPIKES_FOUR) {\n                    this.currentSate = this.stateMachine.get(ENITIY_TYPE_SPIKES_ENUM.SPIKES_FOUR)\n                }\n                else {\n                    this.currentSate = this.currentSate\n                }\n                break;\n\n            default:\n                this.currentSate = this.stateMachine.get(ENITIY_TYPE_SPIKES_ENUM.SPIKES_ONE)\n                break;\n        }\n    }\n}"]}