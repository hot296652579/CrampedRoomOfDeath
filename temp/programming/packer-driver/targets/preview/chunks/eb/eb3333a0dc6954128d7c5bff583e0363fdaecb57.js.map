{"version":3,"sources":["file:///Users/super_javan/cocoscreator/CrampedRoomOfDeathDungeon/assets/Scripts/Burst/BurstMgr.ts"],"names":["_decorator","UITransform","ENTITY_STATE_ENUM","ENUM_EVENT","EnitiyMgr","EventMgr","DataManager","TILE_HEIGHT","TILE_WIDTH","BurstStateMachine","MOVE_SPEED","ccclass","property","BurstMgr","init","params","fsm","addComponent","transform","node","getComponent","setContentSize","onAttack","x","playerX","y","playerY","Instance","playerInfo","state","IDLE","ATTACK","DEATH","emit","ENUM_PLAYER_DEATH","AIRDEATH","console","log","update","setPosition","onLoad","addEventListen","ENUM_MOVE_END","onDestry","onDestroy","unEventListen"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACoBA,MAAAA,U,OAAAA,U;AAA0BC,MAAAA,W,OAAAA,W;;AACmBC,MAAAA,iB,iBAAAA,iB;AAAmBC,MAAAA,U,iBAAAA,U;;AAE3EC,MAAAA,S,iBAAAA,S;;AACFC,MAAAA,Q;;AAEAC,MAAAA,W;;AACEC,MAAAA,W,iBAAAA,W;AAAaC,MAAAA,U,iBAAAA,U;;AACbC,MAAAA,iB,iBAAAA,iB;;;;;;;;;4BAEIC,U,GAAa,IAAI,E;;OAExB;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBZ,U;;0BAEjBa,Q,WADZF,OAAO,CAAC,UAAD,C,gBAAR,MACaE,QADb;AAAA;AAAA,kCACwC;AAE9BC,QAAAA,IAAI,CAACC,MAAD,EAAkB;AAAA;AAAA;;AAAA;AACxB,YAAA,KAAI,CAACC,GAAL,GAAW,KAAI,CAACC,YAAL;AAAA;AAAA,uDAAX;AACA,kBAAM,KAAI,CAACD,GAAL,CAASF,IAAT,EAAN;;AAEA,6CAAWC,MAAX;;AACA,gBAAMG,SAAS,GAAG,KAAI,CAACC,IAAL,CAAUC,YAAV,CAAuBnB,WAAvB,CAAlB;;AACAiB,YAAAA,SAAS,CAACG,cAAV;AAAA;AAAA;AAAA;AAAA;AANwB;AAO3B;;AAEDC,QAAAA,QAAQ,GAAG;AACP,cAAM;AAAEC,YAAAA,CAAC,EAAEC,OAAL;AAAcC,YAAAA,CAAC,EAAEC;AAAjB,cAA6B;AAAA;AAAA,0CAAYC,QAAZ,CAAqBC,UAAxD;;AACA,cAAIJ,OAAO,IAAI,KAAKD,CAAhB,IAAqBG,OAAO,IAAI,KAAKD,CAArC,IAA0C,KAAKI,KAAL,KAAe;AAAA;AAAA,sDAAkBC,IAA/E,EAAqF;AACjF,iBAAKD,KAAL,GAAa;AAAA;AAAA,wDAAkBE,MAA/B;AACH,WAFD,MAEO,IAAI,KAAKF,KAAL,KAAe;AAAA;AAAA,sDAAkBE,MAArC,EAA6C;AAChD,iBAAKF,KAAL,GAAa;AAAA;AAAA,wDAAkBG,KAA/B;;AACA,gBAAI,KAAKT,CAAL,KAAWC,OAAX,IAAsB,KAAKC,CAAL,KAAWC,OAArC,EAA8C;AAC1C;AAAA;AAAA,wCAASC,QAAT,CAAkBM,IAAlB,CAAuB;AAAA;AAAA,4CAAWC,iBAAlC,EAAqD;AAAA;AAAA,0DAAkBC,QAAvE;AACAC,cAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;AACH;AACJ;AACJ;;AAEDC,QAAAA,MAAM,GAAG;AACL,eAAKnB,IAAL,CAAUoB,WAAV,CAAsB,KAAKhB,CAAL;AAAA;AAAA,uCAAtB,EAA2C,CAAC,KAAKE,CAAN;AAAA;AAAA,yCAA3C;AACH;;AAEDe,QAAAA,MAAM,GAAG;AACL;AAAA;AAAA,oCAASb,QAAT,CAAkBc,cAAlB,CAAiC;AAAA;AAAA,wCAAWC,aAA5C,EAA2D,KAAKpB,QAAhE,EAA0E,IAA1E;AACH;;AAEDqB,QAAAA,QAAQ,GAAG;AACP,gBAAMC,SAAN;AACA;AAAA;AAAA,oCAASjB,QAAT,CAAkBkB,aAAlB,CAAgC;AAAA;AAAA,wCAAWH,aAA3C,EAA0D,KAAKpB,QAA/D;AACH;;AAnCmC,O","sourcesContent":["/**陷阱管理器 */\nimport { Component, _decorator, Node, Sprite, UITransform, Animation, SpriteAtlas, AnimationClip, animation, SpriteFrame, Texture2D, math, TiledUserNodeData } from \"cc\";\nimport { DIRECTION_ENUM, DIRECTION_ORDER_ENUM, ENITIY_TYPE_ENUM, ENTITY_STATE_ENUM, ENUM_EVENT, ENUM_BOTTOM_CONTROLLER, PARAMS_NAME_TYPE } from \"../../Enum\";\nimport { IEnitiy } from \"../../Levels\";\nimport { EnitiyMgr } from \"../Base/EnitiyMgr\";\nimport EventMgr from \"../Base/EventMgr\";\nimport { PlayerStateMachine } from \"../Player/PlayerStateMachine\";\nimport DataManager from \"../Runtime/DataManager\";\nimport { TILE_HEIGHT, TILE_WIDTH } from \"../TileMap/TileManager\";\nimport { BurstStateMachine } from \"./BurstStateMachine\";\n\nexport const MOVE_SPEED = 1 / 10\n\nconst { ccclass, property } = _decorator;\n@ccclass('BurstMgr')\nexport class BurstMgr extends EnitiyMgr {\n\n    async init(params: IEnitiy) {\n        this.fsm = this.addComponent(BurstStateMachine)\n        await this.fsm.init()\n\n        super.init(params)\n        const transform = this.node.getComponent(UITransform)\n        transform.setContentSize(TILE_WIDTH, TILE_HEIGHT)\n    }\n\n    onAttack() {\n        const { x: playerX, y: playerY } = DataManager.Instance.playerInfo\n        if (playerX == this.x && playerY == this.y && this.state === ENTITY_STATE_ENUM.IDLE) {\n            this.state = ENTITY_STATE_ENUM.ATTACK\n        } else if (this.state === ENTITY_STATE_ENUM.ATTACK) {\n            this.state = ENTITY_STATE_ENUM.DEATH\n            if (this.x === playerX && this.y === playerY) {\n                EventMgr.Instance.emit(ENUM_EVENT.ENUM_PLAYER_DEATH, ENTITY_STATE_ENUM.AIRDEATH)\n                console.log('陷阱攻击敌人')\n            }\n        }\n    }\n\n    update() {\n        this.node.setPosition(this.x * TILE_WIDTH, -this.y * TILE_HEIGHT)\n    }\n\n    onLoad() {\n        EventMgr.Instance.addEventListen(ENUM_EVENT.ENUM_MOVE_END, this.onAttack, this)\n    }\n\n    onDestry() {\n        super.onDestroy()\n        EventMgr.Instance.unEventListen(ENUM_EVENT.ENUM_MOVE_END, this.onAttack)\n    }\n\n\n}"]}