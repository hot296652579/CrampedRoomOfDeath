{"version":3,"sources":["file:///Users/super_javan/cocoscreator/CrampedRoomOfDeathDungeon/assets/Scripts/TileMap/TileMapManager.ts"],"names":["Component","_decorator","Node","resources","Sprite","UITransform","Layers","SpriteAtlas","levels","TILE_WIDTH","TILE_HEIGHT","ccclass","property","TileMapManager","start","loadTileAtlas","load","err","atlas","console","log","init","spriteAtlas","loadRes","mapInfo","getSpriteFrame","index","length","colnum","j","item","src","type","node","sprite","addComponent","imgSrc","transfrom","setContentSize","layer","nameToLayer","setPosition","setParent","Promise","resolve","reject"],"mappings":"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","sourcesContent":["import { Component, _decorator, Node, resources, SpriteFrame, Sprite, UITransform, Layers, SpriteAtlas } from \"cc\";\nimport levels from \"../../Levels\";\n\nconst TILE_WIDTH = 55\nconst TILE_HEIGHT = 55\n\nconst { ccclass, property } = _decorator;\n@ccclass('TileMapManager')\nexport class TileMapManager extends Component {\n    start() {\n        this.loadTileAtlas()\n    }\n\n    loadTileAtlas() {\n        resources.load(\"texture/tile/tile\", SpriteAtlas, (err, atlas) => {\n            console.log(atlas)\n        });\n    }\n\n    async init() {\n        const spriteAtlas = await this.loadRes()\n        const { mapInfo } = levels[`level${1}`]\n        spriteAtlas.getSpriteFrame('tile (14)')\n        for (let index = 0; index < mapInfo.length; index++) {\n            const colnum = mapInfo[index];\n            for (let j = 0; j < colnum.length; j++) {\n                const item = colnum[j];\n                if (item.src === null || item.type === null) {\n                    continue\n                }\n\n                const node = new Node()\n                const sprite = node.addComponent(Sprite)\n                const imgSrc = `tile (${item.src})`\n\n                // sprite.spriteFrame = spriteFrames.find(v => v.name === imgSrc) || spriteFrames[0]    \n\n                // for (const key in spriteFrames) {\n                //     if (Object.prototype.hasOwnProperty.call(spriteFrames, key)) {\n                //         const sp = spriteFrames[key];\n                //         if (key == String(item.src)) {\n                //             sprite.spriteFrame = sp\n                //         }\n                //     }\n                // }\n                const transfrom = node.addComponent(UITransform)\n                transfrom.setContentSize(TILE_WIDTH, TILE_HEIGHT)\n\n                node.layer = 1 << Layers.nameToLayer('UI_2D')\n                node.setPosition(index * TILE_WIDTH, -j * TILE_HEIGHT)\n                node.setParent(this.node)\n            }\n        }\n    }\n\n    loadRes() {\n        return new Promise<SpriteAtlas>((resolve, reject) => {\n            // resources.loadDir(\"texture/tile/tile\", SpriteFrame, function (err, assets) {\n            //     if (!err) {\n            //         resolve(assets)\n            //         return\n            //     } else {\n            //         console.log(err)\n            //         reject(false)\n            //     }\n            // });\n            resources.load(\"texture/tile/tile\", SpriteAtlas, (err, atlas) => {\n                if (!err) {\n                    resolve(atlas)\n                    return\n                } else {\n                    console.log(err)\n                    reject(false)\n                }\n            });\n        })\n    }\n}"]}