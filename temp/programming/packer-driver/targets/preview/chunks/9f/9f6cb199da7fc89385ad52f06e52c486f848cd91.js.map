{"version":3,"sources":["file:///Users/super_javan/cocoscreator/CrampedRoomOfDeathDungeon/assets/Scripts/Player/PlayerMgr.ts"],"names":["Component","_decorator","Sprite","UITransform","ENUM_EVENT","ENUM_MOVE","PARAMS_NAME_TYPE","EventMgr","TILE_HEIGHT","TILE_WIDTH","PlayerStateMachine","MOVE_SPEED","ccclass","property","PlayerMrg","x","y","tartgetX","tartgetY","fsm","init","sprite","addComponent","sizeMode","SizeMode","CUSTOM","transform","node","getComponent","setContentSize","setParams","IDEL","onLoad","Instance","addEventListen","ENUM_MOVE_PLAYER","handlerMove","onDestry","unEventListen","update","updateXY","setPosition","Math","abs","direction","TOP","BOTTOM","LEFT","RIGHT","TURNLEFT","TURNRIGHT"],"mappings":"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","sourcesContent":["import { Component, _decorator, Node, Sprite, UITransform, Animation, SpriteAtlas, AnimationClip, animation, SpriteFrame, Texture2D, math } from \"cc\";\nimport { ENUM_EVENT, ENUM_MOVE, PARAMS_NAME_TYPE } from \"../../Enum\";\nimport levels, { ILevel } from \"../../Levels\";\nimport EventMgr from \"../Base/EventMgr\";\nimport ResourceLoadMgr from \"../Base/ResourceLoadMgr\";\nimport DataManager from \"../Runtime/DataManager\";\nimport { TILE_HEIGHT, TILE_WIDTH } from \"../TileMap/TileManager\";\n// import { DataManager.Instance } from \"../Runtime/DataManager\";\nimport { TileMapManager } from \"../TileMap/TileMapManager\";\nimport { createNewNode } from \"../Utils\";\nimport { PlayerStateMachine } from \"./PlayerStateMachine\";\n\nexport const MOVE_SPEED = 1 / 10\n\nconst { ccclass, property } = _decorator;\n@ccclass('PlayerMrg')\nexport class PlayerMrg extends Component {\n    x: number = 0\n    y: number = 0\n\n    tartgetX: number = 0\n    tartgetY: number = 0\n\n    fsm: PlayerStateMachine = null\n\n    async init() {\n        const sprite = this.addComponent(Sprite)\n        sprite.sizeMode = Sprite.SizeMode.CUSTOM\n        const transform = this.node.getComponent(UITransform)\n        transform.setContentSize(TILE_WIDTH * 4, TILE_HEIGHT * 4)\n\n        this.fsm = this.addComponent(PlayerStateMachine)\n        this.fsm.init()\n        this.fsm.setParams(PARAMS_NAME_TYPE.IDEL, true)\n    }\n\n    onLoad() {\n        EventMgr.Instance.addEventListen(ENUM_EVENT.ENUM_MOVE_PLAYER, this.handlerMove, this)\n    }\n\n    onDestry() {\n        EventMgr.Instance.unEventListen(ENUM_EVENT.ENUM_MOVE_PLAYER, this.handlerMove)\n    }\n\n    update() {\n        this.updateXY()\n        this.node.setPosition(this.x * TILE_WIDTH - TILE_WIDTH * 1.5, -this.y * TILE_HEIGHT + TILE_HEIGHT * 1.5)\n    }\n\n    updateXY() {\n        if (this.tartgetX < this.x) {\n            this.x -= MOVE_SPEED\n        } else if (this.tartgetX > this.x) {\n            this.x += MOVE_SPEED\n        } else if (this.tartgetY < this.y) {\n            this.y -= MOVE_SPEED\n        } else if (this.tartgetY > this.y) {\n            this.y += MOVE_SPEED\n        }\n\n        if (Math.abs(this.tartgetX - this.x) <= 0.1 && Math.abs(this.tartgetY - this.y) <= 0.1) {\n            this.x = this.tartgetX\n            this.y = this.tartgetY\n        }\n    }\n\n    handlerMove(direction: ENUM_MOVE) {\n        switch (direction) {\n            case ENUM_MOVE.TOP:\n                this.tartgetY -= 1\n                break;\n            case ENUM_MOVE.BOTTOM:\n                this.tartgetY += 1\n                break;\n            case ENUM_MOVE.LEFT:\n                this.tartgetX -= 1\n                break;\n            case ENUM_MOVE.RIGHT:\n                this.tartgetX += 1\n                break;\n            case ENUM_MOVE.TURNLEFT:\n                this.fsm.setParams(PARAMS_NAME_TYPE.TURNLEFT, true)\n                break;\n            case ENUM_MOVE.TURNRIGHT:\n\n                break;\n\n            default:\n                break;\n        }\n    }\n}"]}