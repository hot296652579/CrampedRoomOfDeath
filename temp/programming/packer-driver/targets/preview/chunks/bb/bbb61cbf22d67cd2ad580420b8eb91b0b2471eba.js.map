{"version":3,"sources":["file:///Users/super_javan/cocoscreator/CrampedRoomOfDeathDungeon/assets/Scripts/Player/PlayerMgr.ts"],"names":["_decorator","DIRECTION_ENUM","ENITIY_TYPE_ENUM","ENTITY_STATE_ENUM","ENUM_EVENT","ENUM_BOTTOM_CONTROLLER","EventMgr","DataManager","PlayerStateMachine","EnitiyMgr","MOVE_SPEED","ccclass","property","PlayerMrg","tartgetX","tartgetY","isMoving","init","fsm","addComponent","x","y","type","PLAYER","state","IDLE","direction","TOP","onLoad","Instance","addEventListen","ENUM_MOVE_PLAYER","inputHanlder","ENUM_PLAYER_DEATH","onDeathHanlder","onDestry","unEventListen","update","updateXY","Math","abs","emit","ENUM_MOVE_END","inputDirection","DEATH","AIRDEATH","willBlock","console","log","willAttack","handlerMove","tileMgrInfo","mapColumCount","mapRowCount","playerNextY","BLOCKFRONT","weaponNextY","nextPlayerTile","nextWeaponTile","canMove","canTurn","BOTTOM","BLOCKBACK","LEFT","BLOCKRIGHT","weaponNextX","RIGHT","BLOCKLEFT","playerNextX","TURNLEFT","nextY","nextX","BLOCKTURNLEFT","TURNRIGHT","BLOCKTURNRIGHT","enemies","index","length","enemyX","enemyY","ATTACK"],"mappings":"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","sourcesContent":["import { Component, _decorator, Node, Sprite, UITransform, Animation, SpriteAtlas, AnimationClip, animation, SpriteFrame, Texture2D, math } from \"cc\";\nimport { DIRECTION_ENUM, DIRECTION_ORDER_ENUM, ENITIY_TYPE_ENUM, ENTITY_STATE_ENUM, ENUM_EVENT, ENUM_BOTTOM_CONTROLLER, PARAMS_NAME_TYPE } from \"../../Enum\";\nimport levels, { ILevel } from \"../../Levels\";\nimport EventMgr from \"../Base/EventMgr\";\nimport ResourceLoadMgr from \"../Base/ResourceLoadMgr\";\nimport DataManager from \"../Runtime/DataManager\";\nimport { TILE_HEIGHT, TILE_WIDTH } from \"../TileMap/TileManager\";\n// import { DataManager.Instance } from \"../Runtime/DataManager\";\nimport { TileMapManager } from \"../TileMap/TileMapManager\";\nimport { createNewNode } from \"../Utils\";\nimport { PlayerStateMachine } from \"../Base/PlayerStateMachine\";\nimport { EnitiyMgr } from \"../Base/EnitiyMgr\";\n\nexport const MOVE_SPEED = 1 / 10\n\nconst { ccclass, property } = _decorator;\n@ccclass('PlayerMrg')\nexport class PlayerMrg extends EnitiyMgr {\n\n    tartgetX: number = 0\n    tartgetY: number = 0\n    isMoving: boolean = false\n\n    async init() {\n        this.fsm = this.addComponent(PlayerStateMachine)\n        await this.fsm.init()\n\n        super.init({\n            x: 2,\n            y: 7,\n            type: ENITIY_TYPE_ENUM.PLAYER,\n            state: ENTITY_STATE_ENUM.IDLE,\n            direction: DIRECTION_ENUM.TOP\n        })\n\n        this.tartgetX = this.x\n        this.tartgetY = this.y\n    }\n\n    onLoad() {\n        EventMgr.Instance.addEventListen(ENUM_EVENT.ENUM_MOVE_PLAYER, this.inputHanlder, this)\n        EventMgr.Instance.addEventListen(ENUM_EVENT.ENUM_PLAYER_DEATH, this.onDeathHanlder, this)\n    }\n\n    onDestry() {\n        EventMgr.Instance.unEventListen(ENUM_EVENT.ENUM_MOVE_PLAYER, this.inputHanlder)\n        EventMgr.Instance.unEventListen(ENUM_EVENT.ENUM_PLAYER_DEATH, this.onDeathHanlder)\n    }\n\n    update() {\n        this.updateXY()\n        super.update()\n    }\n\n    updateXY() {\n        if (this.tartgetX < this.x) {\n            this.x -= MOVE_SPEED\n        } else if (this.tartgetX > this.x) {\n            this.x += MOVE_SPEED\n        } else if (this.tartgetY < this.y) {\n            this.y -= MOVE_SPEED\n        } else if (this.tartgetY > this.y) {\n            this.y += MOVE_SPEED\n        }\n\n        if (Math.abs(this.tartgetX - this.x) <= 0.1 && Math.abs(this.tartgetY - this.y) <= 0.1 && this.isMoving) {\n            this.isMoving = false\n            this.x = this.tartgetX\n            this.y = this.tartgetY\n\n            EventMgr.Instance.emit(ENUM_EVENT.ENUM_MOVE_END)\n        }\n    }\n\n    inputHanlder(inputDirection: ENUM_BOTTOM_CONTROLLER) {\n        if (this.state === ENTITY_STATE_ENUM.DEATH || this.state === ENTITY_STATE_ENUM.AIRDEATH)\n            return\n\n        if (this.isMoving)\n            return\n\n        if (this.willBlock(inputDirection)) {\n            console.log('block!!!!')\n            return\n        }\n\n        if (this.willAttack(inputDirection)) {\n            return\n        }\n\n        this.handlerMove(inputDirection)\n    }\n\n    onDeathHanlder(type: ENTITY_STATE_ENUM) {\n        this.state = type\n    }\n\n    willBlock(inputDirection: ENUM_BOTTOM_CONTROLLER) {\n        const { tartgetX: x, tartgetY: y, direction } = this\n        const { tileMgrInfo, mapColumCount, mapRowCount } = DataManager.Instance\n\n        console.log('y', y)\n\n        //先判断输入上时候\n        if (inputDirection === ENUM_BOTTOM_CONTROLLER.TOP) {\n            const playerNextY = y - 1\n\n            //玩家方向——向上\n            if (direction === DIRECTION_ENUM.TOP) {\n                //判断是否超出地图\n                if (playerNextY <= 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKFRONT\n                    return true\n                }\n\n                const weaponNextY = y - 2\n                const nextPlayerTile = tileMgrInfo[x]?.[playerNextY]\n                const nextWeaponTile = tileMgrInfo[x]?.[weaponNextY]\n\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKFRONT\n                    return true\n                }\n\n                //玩家方向——向下\n            } else if (direction === DIRECTION_ENUM.BOTTOM) {\n                //判断是否超出地图\n                if (playerNextY <= 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKBACK\n                    return true\n                }\n\n                const weaponNextY = y\n                const nextPlayerTile = tileMgrInfo[x]?.[playerNextY]\n                const nextWeaponTile = tileMgrInfo[x]?.[weaponNextY]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKBACK\n                    return true\n                }\n\n                //玩家方向——向左\n            } else if (direction === DIRECTION_ENUM.LEFT) {\n                //判断是否超出地图\n                if (playerNextY <= 0) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKRIGHT\n                    return true\n                }\n\n                const weaponNextX = x - 1\n                const weaponNextY = y - 1\n                const nextPlayerTile = tileMgrInfo[x]?.[playerNextY]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[weaponNextY]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKRIGHT\n                    return true\n                }\n\n                //玩家方向——向右\n            } else if (direction === DIRECTION_ENUM.RIGHT) {\n                //判断是否超出地图\n                if (playerNextY <= 0) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKLEFT\n                    return true\n                }\n\n                const weaponNextX = x + 1\n                const weaponNextY = y - 1\n                const nextPlayerTile = tileMgrInfo[x]?.[playerNextY]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[weaponNextY]\n\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKLEFT\n                    return true\n                }\n            }\n        } else if (inputDirection === ENUM_BOTTOM_CONTROLLER.LEFT) {\n            const playerNextX = x - 1\n\n            //玩家方向——向上\n            if (direction === DIRECTION_ENUM.TOP) {\n                //判断是否超出地图\n                if (playerNextX <= 0) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKLEFT\n\n                    return true\n                }\n\n                const weaponNextX = x - 1\n                const weaponNextY = y - 1\n                const nextPlayerTile = tileMgrInfo[playerNextX]?.[y]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[weaponNextY]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKLEFT\n                    return true\n                }\n\n                //玩家方向——向下\n            } else if (direction === DIRECTION_ENUM.BOTTOM) {\n                //判断是否超出地图\n                if (playerNextX <= 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKRIGHT\n\n                    return true\n                }\n\n                const weaponNextX = x - 1\n                const weaponNextY = y + 1\n                const nextPlayerTile = tileMgrInfo[playerNextX]?.[y]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[weaponNextY]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKRIGHT\n                    return true\n                }\n\n                //玩家方向——向左\n            } else if (direction === DIRECTION_ENUM.LEFT) {\n                //判断是否超出地图\n                if (playerNextX <= 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKFRONT\n\n                    return true\n                }\n\n                const weaponNextX = x - 2\n                const nextPlayerTile = tileMgrInfo[playerNextX]?.[y]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[y]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKFRONT\n                    return true\n                }\n\n                //玩家方向——向右\n            } else if (direction === DIRECTION_ENUM.RIGHT) {\n                //判断是否超出地图\n                if (playerNextX <= 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKBACK\n\n                    return true\n                }\n\n                const weaponNextX = x\n                const nextPlayerTile = tileMgrInfo[playerNextX]?.[y]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[y]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKBACK\n                    return true\n                }\n            }\n\n        } else if (inputDirection === ENUM_BOTTOM_CONTROLLER.RIGHT) {\n            const playerNextX = x + 1\n\n            //玩家方向——向上\n            if (direction === DIRECTION_ENUM.TOP) {\n                if (playerNextX > mapColumCount - 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKRIGHT\n\n                    return true\n                }\n\n                const weaponNextX = x + 1\n                const weaponNextY = y - 1\n                const nextPlayerTile = tileMgrInfo[playerNextX]?.[y]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[weaponNextY]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKRIGHT\n                    return true\n                }\n\n                //玩家方向——向下\n            } else if (direction === DIRECTION_ENUM.BOTTOM) {\n                if (playerNextX > mapColumCount - 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKLEFT\n\n                    return true\n                }\n\n                const weaponNextX = x + 1\n                const weaponNextY = y + 1\n                const nextPlayerTile = tileMgrInfo[playerNextX]?.[y]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[weaponNextY]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKLEFT\n                    return true\n                }\n\n                //玩家方向——向左\n            } else if (direction === DIRECTION_ENUM.LEFT) {\n                if (playerNextX > mapColumCount - 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKBACK\n\n                    return true\n                }\n\n                const weaponNextX = x\n                const nextPlayerTile = tileMgrInfo[playerNextX]?.[y]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[y]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKBACK\n                    return true\n                }\n\n                //玩家方向——向右\n            } else if (direction === DIRECTION_ENUM.RIGHT) {\n                if (playerNextX > mapColumCount - 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKFRONT\n\n                    return true\n                }\n\n                const weaponNextX = x + 2\n                const nextPlayerTile = tileMgrInfo[playerNextX]?.[y]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[y]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKFRONT\n                    return true\n                }\n            }\n        } else if (inputDirection === ENUM_BOTTOM_CONTROLLER.BOTTOM) {\n            const playerNextY = y + 1\n            //玩家方向——向上\n            if (direction === DIRECTION_ENUM.TOP) {\n                if (playerNextY > mapColumCount - 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKBACK\n                    return true\n                }\n\n                const weaponNextY = y\n                const nextPlayerTile = tileMgrInfo[x]?.[playerNextY]\n                const nextWeaponTile = tileMgrInfo[x]?.[weaponNextY]\n\n\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKBACK\n                    return true\n                }\n\n                //玩家方向——向下\n            } else if (direction === DIRECTION_ENUM.BOTTOM) {\n                if (playerNextY > mapColumCount - 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKFRONT\n\n                    return true\n                }\n\n                const weaponNextY = y + 2\n                const nextPlayerTile = tileMgrInfo[x]?.[playerNextY]\n                const nextWeaponTile = tileMgrInfo[x]?.[weaponNextY]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKFRONT\n                    return true\n                }\n\n                //玩家方向——向左\n            } else if (direction === DIRECTION_ENUM.LEFT) {\n                if (playerNextY > mapColumCount - 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKLEFT\n\n                    return true\n                }\n\n                const weaponNextX = x - 1\n                const weaponNextY = y + 1\n                const nextPlayerTile = tileMgrInfo[x]?.[playerNextY]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[weaponNextY]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKLEFT\n                    return true\n                }\n\n                //玩家方向——向右\n            } else if (direction === DIRECTION_ENUM.RIGHT) {\n                if (playerNextY > mapColumCount - 1) {\n                    this.state = ENTITY_STATE_ENUM.BLOCKRIGHT\n\n                    return true\n                }\n\n                const weaponNextX = x + 1\n                const weaponNextY = y + 1\n                const nextPlayerTile = tileMgrInfo[x]?.[playerNextY]\n                const nextWeaponTile = tileMgrInfo[weaponNextX]?.[weaponNextY]\n\n                //最后判断地图元素\n                if (nextPlayerTile && nextPlayerTile.canMove && (!nextWeaponTile || nextWeaponTile.canTurn)) {\n                    // empty\n                } else {\n                    this.state = ENTITY_STATE_ENUM.BLOCKRIGHT\n                    return true\n                }\n            }\n\n        } else if (inputDirection === ENUM_BOTTOM_CONTROLLER.TURNLEFT) {\n            let nextY, nextX\n            if (direction === DIRECTION_ENUM.TOP) {\n                //朝上左转的话，左上角三个tile都必须turnable为true，并且没有敌人\n                nextY = y - 1\n                nextX = x - 1\n            } else if (direction === DIRECTION_ENUM.BOTTOM) {\n                nextY = y + 1\n                nextX = x + 1\n            } else if (direction === DIRECTION_ENUM.LEFT) {\n                nextY = y + 1\n                nextX = x - 1\n            } else if (direction === DIRECTION_ENUM.RIGHT) {\n                nextY = y - 1\n                nextX = x + 1\n            }\n\n            //最后判断地图元素\n            if (\n                (!tileMgrInfo[x]?.[nextY] || tileMgrInfo[x]?.[nextY].canTurn) &&\n                (!tileMgrInfo[nextX]?.[y] || tileMgrInfo[nextX]?.[y].canTurn) &&\n                (!tileMgrInfo[nextX]?.[nextY] || tileMgrInfo[nextX]?.[nextY].canTurn)\n            ) {\n                // empty\n            } else {\n                this.state = ENTITY_STATE_ENUM.BLOCKTURNLEFT\n                return true\n            }\n        } else if (inputDirection === ENUM_BOTTOM_CONTROLLER.TURNRIGHT) {\n            let nextX, nextY\n            if (direction === DIRECTION_ENUM.TOP) {\n                //朝上右转的话，右上角三个tile都必须turnable为true\n                nextY = y - 1\n                nextX = x + 1\n            } else if (direction === DIRECTION_ENUM.BOTTOM) {\n                nextY = y + 1\n                nextX = x - 1\n            } else if (direction === DIRECTION_ENUM.LEFT) {\n                nextY = y - 1\n                nextX = x - 1\n            } else if (direction === DIRECTION_ENUM.RIGHT) {\n                nextY = y + 1\n                nextX = x + 1\n            }\n\n            //最后判断地图元素\n            if (\n                (!tileMgrInfo[x]?.[nextY] || tileMgrInfo[x]?.[nextY].canTurn) &&\n                (!tileMgrInfo[nextX]?.[y] || tileMgrInfo[nextX]?.[y].canTurn) &&\n                (!tileMgrInfo[nextX]?.[nextY] || tileMgrInfo[nextX]?.[nextY].canTurn)\n            ) {\n                // empty\n            } else {\n                this.state = ENTITY_STATE_ENUM.BLOCKTURNRIGHT\n                return true\n            }\n        }\n\n        return false\n    }\n\n    willAttack(inputDirection: ENUM_BOTTOM_CONTROLLER) {\n        const { enemies } = DataManager.Instance\n\n        for (let index = 0; index < enemies.length; index++) {\n            const { x: enemyX, y: enemyY } = enemies[index];\n            if (inputDirection === ENUM_BOTTOM_CONTROLLER.TOP && this.direction === DIRECTION_ENUM.TOP && enemyX == this.x && enemyY == this.y - 2) {\n                this.state = ENTITY_STATE_ENUM.ATTACK\n                return true\n            }\n        }\n\n        return false\n    }\n\n    handlerMove(direction: ENUM_BOTTOM_CONTROLLER) {\n        console.log(DataManager.Instance.tileMgrInfo)\n        switch (direction) {\n            case ENUM_BOTTOM_CONTROLLER.TOP:\n                this.isMoving = true\n                this.tartgetY -= 1\n                break;\n            case ENUM_BOTTOM_CONTROLLER.BOTTOM:\n                this.isMoving = true\n                this.tartgetY += 1\n                break;\n            case ENUM_BOTTOM_CONTROLLER.LEFT:\n                this.isMoving = true\n                this.tartgetX -= 1\n                break;\n            case ENUM_BOTTOM_CONTROLLER.RIGHT:\n                this.isMoving = true\n                this.tartgetX += 1\n                break;\n            case ENUM_BOTTOM_CONTROLLER.TURNLEFT:\n                // this.fsm.setParams(PARAMS_NAME_TYPE.TURNLEFT, true)\n\n                if (this.direction === DIRECTION_ENUM.TOP) {\n                    this.direction = DIRECTION_ENUM.LEFT\n                } else if (this.direction === DIRECTION_ENUM.BOTTOM) {\n                    this.direction = DIRECTION_ENUM.RIGHT\n                } else if (this.direction === DIRECTION_ENUM.LEFT) {\n                    this.direction = DIRECTION_ENUM.BOTTOM\n                } else if (this.direction === DIRECTION_ENUM.RIGHT) {\n                    this.direction = DIRECTION_ENUM.TOP\n                }\n                this.state = ENTITY_STATE_ENUM.TURNLEFT\n                break;\n            case ENUM_BOTTOM_CONTROLLER.TURNRIGHT:\n                if (this.direction === DIRECTION_ENUM.TOP) {\n                    this.direction = DIRECTION_ENUM.RIGHT\n                } else if (this.direction === DIRECTION_ENUM.BOTTOM) {\n                    this.direction = DIRECTION_ENUM.LEFT\n                } else if (this.direction === DIRECTION_ENUM.LEFT) {\n                    this.direction = DIRECTION_ENUM.TOP\n                } else if (this.direction === DIRECTION_ENUM.RIGHT) {\n                    this.direction = DIRECTION_ENUM.BOTTOM\n                }\n                this.state = ENTITY_STATE_ENUM.TURNRIGHT\n                break;\n\n            default:\n                break;\n        }\n    }\n}"]}