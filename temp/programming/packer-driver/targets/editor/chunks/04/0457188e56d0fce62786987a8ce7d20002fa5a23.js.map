{"version":3,"sources":["file:///Users/super_javan/cocoscreator/CrampedRoomOfDeathDungeon/assets/Scripts/Base/EnemyMgr.ts"],"names":["_decorator","DIRECTION_ENUM","ENTITY_STATE_ENUM","ENUM_EVENT","DataManager","EnitiyMgr","EventMgr","ccclass","property","EnemyMgr","init","params","onChangeDirection","Instance","playerInfo","state","DEATH","x","playerX","y","playerY","disX","Math","abs","disY","console","log","direction","RIGHT","TOP","LEFT","BOTTOM","onDeath","id","onLoad","addEventListen","ENUM_MOVE_END","ENUM_PLAYER_BORN","ENUM_ATTACK_ENEMY","onDestroy","unEventListen"],"mappings":"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","sourcesContent":["/**木骷髅管理器 */\nimport { Component, _decorator, Node, Sprite, UITransform, Animation, SpriteAtlas, AnimationClip, animation, SpriteFrame, Texture2D, math } from \"cc\";\nimport { DIRECTION_ENUM, ENTITY_STATE_ENUM, ENUM_EVENT } from \"../../Enum\";\nimport { IEnitiy } from \"../../Levels\";\nimport DataManager from \"../Runtime/DataManager\";\nimport { EnitiyMgr } from \"./EnitiyMgr\";\nimport EventMgr from \"./EventMgr\";\n\nconst { ccclass, property } = _decorator;\n@ccclass('EnemyMgr')\nexport class EnemyMgr extends EnitiyMgr {\n\n    async init(params: IEnitiy) {\n        super.init(params)\n\n        this.onChangeDirection(true)\n    }\n    /***\n     * 根据玩家在敌人的象限改变敌人的朝向\n     */\n    onChangeDirection(init = false) {\n        if (!DataManager.Instance.playerInfo)\n            return\n        if (this.state === ENTITY_STATE_ENUM.DEATH || !DataManager.Instance.playerInfo)\n            return\n\n        const { x: playerX, y: playerY } = DataManager.Instance.playerInfo\n        const disX = Math.abs(this.x - playerX)\n        const disY = Math.abs(this.y - playerY)\n\n        //确保敌人在初始化的时候调整一次direction\n        if (disX === disY && !init) {\n            return\n        }\n        console.log('改变方向 朝向!!!!')\n        //第一象限\n        if (playerX >= this.x && playerY <= this.y) {\n            this.direction = disX >= disY ? DIRECTION_ENUM.RIGHT : DIRECTION_ENUM.TOP\n\n            //第二象限\n        } else if (playerX <= this.x && playerY <= this.y) {\n            this.direction = disX >= disY ? DIRECTION_ENUM.LEFT : DIRECTION_ENUM.TOP\n\n            //第三象限\n        } else if (playerX <= this.x && playerY >= this.y) {\n            this.direction = disX >= disY ? DIRECTION_ENUM.LEFT : DIRECTION_ENUM.BOTTOM\n\n            //第四象限\n        } else if (playerX >= this.x && playerY >= this.y) {\n            this.direction = disX >= disY ? DIRECTION_ENUM.RIGHT : DIRECTION_ENUM.BOTTOM\n        }\n    }\n\n    onDeath(id: string) {\n        if (this.state === ENTITY_STATE_ENUM.DEATH) {\n            return\n        }\n        if (this.id === id) {\n            this.state = ENTITY_STATE_ENUM.DEATH\n        }\n    }\n\n    onLoad() {\n        EventMgr.Instance.addEventListen(ENUM_EVENT.ENUM_MOVE_END, this.onChangeDirection, this)\n        EventMgr.Instance.addEventListen(ENUM_EVENT.ENUM_PLAYER_BORN, this.onChangeDirection, this)\n        EventMgr.Instance.addEventListen(ENUM_EVENT.ENUM_ATTACK_ENEMY, this.onDeath, this)\n    }\n\n    onDestroy() {\n        super.onDestroy()\n        EventMgr.Instance.unEventListen(ENUM_EVENT.ENUM_MOVE_END, this.onChangeDirection)\n        EventMgr.Instance.unEventListen(ENUM_EVENT.ENUM_PLAYER_BORN, this.onChangeDirection)\n        EventMgr.Instance.unEventListen(ENUM_EVENT.ENUM_ATTACK_ENEMY, this.onDeath)\n    }\n\n\n}"]}