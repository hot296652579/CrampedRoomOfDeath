{"version":3,"sources":["file:///Users/super_javan/cocoscreator/CrampedRoomOfDeathDungeon/assets/Scripts/Enemy/Wooden/WoodenStateMachine.ts"],"names":["_decorator","Animation","PARAMS_NAME_TYPE","ENTITY_STATE_ENUM","EnitiyMgr","getParamsInitNumber","getParamsInitTrigger","StateMachine","AudioMgr","AttackWoodenSubStateMachine","DeathWoodenSubStateMachine","IdleWoodenSubStateMachine","ccclass","property","WoodenStateMachine","init","animationCom","addComponent","initParams","initSateMachine","addAnimationEvent","Promise","all","waitList","params","set","IDLE","ATTACK","DEATH","DIRECTION","stateMachine","on","EventType","FINISHED","animationName","defaultClip","name","list","some","v","includes","node","getComponent","state","run","currentSate","get","value","inst","playOneShot"],"mappings":"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","sourcesContent":["import { Component, _decorator, Node, AnimationClip, Animation, SpriteFrame, SpriteAtlas } from \"cc\";\nimport { ENUM_EVENT, ENUM_BOTTOM_CONTROLLER, FSM_PARAMS_TYPE_ENUM, PARAMS_NAME_TYPE, ENITIY_TYPE_ENUM, ENTITY_STATE_ENUM } from \"../../../Enum\";\n// import { DataManager.Instance } from \"../Runtime/DataManager\";\nimport { EnitiyMgr } from \"../../Base/EnitiyMgr\";\nimport { getParamsInitNumber, getParamsInitTrigger, StateMachine } from \"../../Base/SateMachine\";\nimport State from \"../../Base/State\";\nimport { AudioMgr } from \"../../Runtime/AudioMgr\";\nimport AttackWoodenSubStateMachine from \"./AttackWoondenSubStateMachine\";\nimport DeathWoodenSubStateMachine from \"./DeathWoodenSubStateMachine\";\nimport IdleWoodenSubStateMachine from \"./IdleWoodenSubStateMachine\";\n\n\nconst { ccclass, property } = _decorator;\n@ccclass('WoodenStateMachine')\nexport class WoodenStateMachine extends StateMachine {\n    async init() {\n        this.animationCom = this.addComponent(Animation)\n\n        this.initParams()\n        this.initSateMachine()\n        this.addAnimationEvent()\n\n        await Promise.all(this.waitList)\n    }\n\n    initParams() {\n        this.params.set(PARAMS_NAME_TYPE.IDLE, getParamsInitTrigger())\n        this.params.set(PARAMS_NAME_TYPE.ATTACK, getParamsInitTrigger())\n        this.params.set(PARAMS_NAME_TYPE.DEATH, getParamsInitTrigger())\n        this.params.set(PARAMS_NAME_TYPE.DIRECTION, getParamsInitNumber())\n    }\n\n    initSateMachine() {\n        this.stateMachine.set(PARAMS_NAME_TYPE.IDLE, new IdleWoodenSubStateMachine(this))\n        this.stateMachine.set(PARAMS_NAME_TYPE.ATTACK, new AttackWoodenSubStateMachine(this))\n        this.stateMachine.set(PARAMS_NAME_TYPE.DEATH, new DeathWoodenSubStateMachine(this))\n    }\n\n    addAnimationEvent() {\n        this.animationCom.on(Animation.EventType.FINISHED, () => {\n            const animationName = this.animationCom.defaultClip.name\n            const list = ['attack']\n\n            if (list.some(v => animationName.includes(v))) {\n                // this.setParams(PARAMS_NAME_TYPE.IDLE, true)\n                this.node.getComponent(EnitiyMgr).state = ENTITY_STATE_ENUM.IDLE\n            }\n        })\n    }\n\n    run() {\n        switch (this.currentSate) {\n            case this.stateMachine.get(PARAMS_NAME_TYPE.ATTACK):\n            case this.stateMachine.get(PARAMS_NAME_TYPE.IDLE):\n\n            case this.stateMachine.get(PARAMS_NAME_TYPE.DEATH):\n                if (this.params.get(PARAMS_NAME_TYPE.DEATH).value) {\n                    this.currentSate = this.stateMachine.get(PARAMS_NAME_TYPE.DEATH)\n                    AudioMgr.inst.playOneShot('sound/enemyDeath')\n                } else if (this.params.get(PARAMS_NAME_TYPE.ATTACK).value) {\n                    this.currentSate = this.stateMachine.get(PARAMS_NAME_TYPE.ATTACK)\n                } else if (this.params.get(PARAMS_NAME_TYPE.IDLE).value) {\n                    this.currentSate = this.stateMachine.get(PARAMS_NAME_TYPE.IDLE)\n                }\n                else {\n                    this.currentSate = this.currentSate\n                }\n                break;\n\n            default:\n                this.currentSate = this.stateMachine.get(PARAMS_NAME_TYPE.IDLE)\n                break;\n        }\n    }\n}"]}